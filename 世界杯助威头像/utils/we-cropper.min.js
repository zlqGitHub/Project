var t = "function" == typeof Symbol && "symbol" == typeof Symbol.iterator ? function(t) {
    return typeof t;
} : function(t) {
    return t && "function" == typeof Symbol && t.constructor === Symbol && t !== Symbol.prototype ? "symbol" : typeof t;
}, e = "function" == typeof Symbol && "symbol" === t(Symbol.iterator) ? function(e) {
    return void 0 === e ? "undefined" : t(e);
} : function(e) {
    return e && "function" == typeof Symbol && e.constructor === Symbol && e !== Symbol.prototype ? "symbol" : void 0 === e ? "undefined" : t(e);
};

!function(t, o) {
    "object" == ("undefined" == typeof exports ? "undefined" : e(exports)) && "undefined" != typeof module ? module.exports = o() : "function" == typeof define && define.amd ? define(o) : t.WeCropper = o();
}(void 0, function() {
    function t(t) {
        return "function" == typeof t;
    }
    function o(t) {
        for (var e = [], o = arguments.length - 1; o-- > 0; ) e[o] = arguments[o + 1];
        c.forEach(function(o, n) {
            void 0 !== e[n] && (t[o] = e[n]);
        });
    }
    function n(t) {
        var e = "";
        if ("string" == typeof t) e = t; else for (var o = 0; o < t.length; o++) e += String.fromCharCode(t[o]);
        return h.encode(e);
    }
    function r(e, o, r, a, i, c, u) {
        var d, s, h, f, l, g;
        void 0 === u && (u = function() {}), void 0 === c && (c = "png"), c = "image/" + c.toLowerCase().replace(/jpg/i, "jpeg").match(/png|jpeg|bmp|gif/)[0], 
        /bmp/.test(c) ? (d = e, s = o, h = r, f = a, l = i, g = function(e) {
            var o = function(t) {
                var e = t.width, o = t.height, r = e * o * 3, a = r + 54, i = [ 66, 77, 255 & a, a >> 8 & 255, a >> 16 & 255, a >> 24 & 255, 0, 0, 0, 0, 54, 0, 0, 0 ], c = [ 40, 0, 0, 0, 255 & e, e >> 8 & 255, e >> 16 & 255, e >> 24 & 255, 255 & o, o >> 8 & 255, o >> 16 & 255, o >> 24 & 255, 1, 0, 24, 0, 0, 0, 0, 0, 255 & r, r >> 8 & 255, r >> 16 & 255, r >> 24 & 255, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0 ], u = (4 - 3 * e % 4) % 4, d = t.data, s = "", h = e << 2, f = o, l = String.fromCharCode;
                do {
                    for (var g = h * (f - 1), v = "", p = 0; p < e; p++) {
                        var y = p << 2;
                        v += l(d[g + y + 2]) + l(d[g + y + 1]) + l(d[g + y]);
                    }
                    for (var m = 0; m < u; m++) v += String.fromCharCode(0);
                    s += v;
                } while (--f);
                return n(i.concat(c)) + n(s);
            }(e);
            t(u) && u("data:image/" + c + ";base64," + o);
        }, wx.canvasGetImageData({
            canvasId: d,
            x: s,
            y: h,
            width: f,
            height: l,
            success: function(t) {
                g(t);
            },
            fail: function(t) {
                g(null), console.error("canvasGetImageData error: " + t);
            }
        })) : console.error("暂不支持生成'" + c + "'类型的base64图片");
    }
    var a, i = void 0, c = [ "touchstarted", "touchmoved", "touchended" ], u = {}, d = {
        id: {
            default: "cropper",
            get: function() {
                return u.id;
            },
            set: function(t) {
                "string" != typeof t && console.error("id：" + t + " is invalid"), u.id = t;
            }
        },
        width: {
            default: 750,
            get: function() {
                return u.width;
            },
            set: function(t) {
                "number" != typeof t && console.error("width：" + t + " is invalid"), u.width = t;
            }
        },
        height: {
            default: 750,
            get: function() {
                return u.height;
            },
            set: function(t) {
                "number" != typeof t && console.error("height：" + t + " is invalid"), u.height = t;
            }
        },
        scale: {
            default: 2.5,
            get: function() {
                return u.scale;
            },
            set: function(t) {
                "number" != typeof t && console.error("scale：" + t + " is invalid"), u.scale = t;
            }
        },
        zoom: {
            default: 5,
            get: function() {
                return u.zoom;
            },
            set: function(t) {
                "number" != typeof t ? console.error("zoom：" + t + " is invalid") : (t < 0 || t > 10) && console.error("zoom should be ranged in 0 ~ 10"), 
                u.zoom = t;
            }
        },
        src: {
            default: "cropper",
            get: function() {
                return u.src;
            },
            set: function(t) {
                "string" != typeof t && console.error("id：" + t + " is invalid"), u.src = t;
            }
        },
        cut: {
            default: {},
            get: function() {
                return u.cut;
            },
            set: function(t) {
                "object" != (void 0 === t ? "undefined" : e(t)) && console.error("id：" + t + " is invalid"), 
                u.cut = t;
            }
        },
        onReady: {
            default: null,
            get: function() {
                return u.ready;
            },
            set: function(t) {
                u.ready = t;
            }
        },
        onBeforeImageLoad: {
            default: null,
            get: function() {
                return u.beforeImageLoad;
            },
            set: function(t) {
                u.beforeImageLoad = t;
            }
        },
        onImageLoad: {
            default: null,
            get: function() {
                return u.imageLoad;
            },
            set: function(t) {
                u.imageLoad = t;
            }
        },
        onBeforeDraw: {
            default: null,
            get: function() {
                return u.beforeDraw;
            },
            set: function(t) {
                u.beforeDraw = t;
            }
        }
    }, s = "undefined" != typeof window ? window : "undefined" != typeof global ? global : "undefined" != typeof self ? self : {}, h = (function(t, o) {
        !function(n) {
            var r = o, a = t && t.exports == r && t, i = "object" == (void 0 === s ? "undefined" : e(s)) && s;
            i.global !== i && i.window !== i || (n = i);
            var c = function(t) {
                this.message = t;
            };
            (c.prototype = new Error()).name = "InvalidCharacterError";
            var u = function(t) {
                throw new c(t);
            }, d = "ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/", h = /[\t\n\f\r ]/g, f = {
                encode: function(t) {
                    t = String(t), /[^\0-\xFF]/.test(t) && u("The string to be encoded contains characters outside of the Latin1 range.");
                    for (var e, o, n, r, a = t.length % 3, i = "", c = -1, s = t.length - a; ++c < s; ) e = t.charCodeAt(c) << 16, 
                    o = t.charCodeAt(++c) << 8, n = t.charCodeAt(++c), i += d.charAt((r = e + o + n) >> 18 & 63) + d.charAt(r >> 12 & 63) + d.charAt(r >> 6 & 63) + d.charAt(63 & r);
                    return 2 == a ? (e = t.charCodeAt(c) << 8, o = t.charCodeAt(++c), i += d.charAt((r = e + o) >> 10) + d.charAt(r >> 4 & 63) + d.charAt(r << 2 & 63) + "=") : 1 == a && (r = t.charCodeAt(c), 
                    i += d.charAt(r >> 2) + d.charAt(r << 4 & 63) + "=="), i;
                },
                decode: function(t) {
                    var e = (t = String(t).replace(h, "")).length;
                    e % 4 == 0 && (e = (t = t.replace(/==?$/, "")).length), (e % 4 == 1 || /[^+a-zA-Z0-9/]/.test(t)) && u("Invalid character: the string to be decoded is not correctly encoded.");
                    for (var o, n, r = 0, a = "", i = -1; ++i < e; ) n = d.indexOf(t.charAt(i)), o = r % 4 ? 64 * o + n : n, 
                    r++ % 4 && (a += String.fromCharCode(255 & o >> (-2 * r & 6)));
                    return a;
                },
                version: "0.1.0"
            };
            if (r && !r.nodeType) if (a) a.exports = f; else for (var l in f) f.hasOwnProperty(l) && (r[l] = f[l]); else n.base64 = f;
        }(s);
    }(a = {
        exports: {}
    }, a.exports), a.exports), f = {
        convertToImage: r,
        convertToBMP: function(t, e) {
            void 0 === t && (t = {});
            var o = t.canvasId, n = t.x, a = t.y, i = t.width, c = t.height;
            return void 0 === e && (e = function() {}), r(o, n, a, i, c, "bmp", e);
        }
    }, l = function(t, e, o, n, r) {
        var a, i;
        return a = Math.round(r.x - n.x), i = Math.round(r.y - n.y), t + .001 * o * (Math.round(Math.sqrt(a * a + i * i)) - e);
    }, g = {
        touchStart: function(t) {
            var e = t.touches, n = e[0], r = e[1];
            o(this, !0, null, null), this.__oneTouchStart(n), t.touches.length >= 2 && this.__twoTouchStart(n, r);
        },
        touchMove: function(t) {
            var e = t.touches, n = e[0], r = e[1];
            o(this, null, !0), 1 === t.touches.length && this.__oneTouchMove(n), t.touches.length >= 2 && this.__twoTouchMove(n, r);
        },
        touchEnd: function(t) {
            o(this, !1, !1, !0), this.__xtouchEnd();
        }
    }, v = function(t) {
        var e, o, n = this, r = {};
        return e = n, o = d, Object.defineProperties(e, o), Object.keys(d).forEach(function(t) {
            r[t] = d[t].default;
        }), Object.assign(n, r, t), n.prepare(), n.attachPage(), n.createCtx(), n.observer(), 
        n.cutt(), n.methods(), n.init(), n.update(), n;
    };
    return v.prototype.init = function() {
        var t = this, e = t.src;
        return t.version = "1.2.0", "function" == typeof t.onReady && t.onReady(t.ctx, t), 
        e && t.pushOrign(e), o(t, !1, !1, !1), t.oldScale = 1, t.newScale = 1, t;
    }, Object.assign(v.prototype, g), v.prototype.prepare = function() {
        var t = this, e = (i || (i = wx.getSystemInfoSync()), i).windowWidth;
        t.attachPage = function() {
            var e = getCurrentPages();
            e[e.length - 1].wecropper = t;
        }, t.createCtx = function() {
            var e = t.id;
            e ? t.ctx = wx.createCanvasContext(e) : console.error("constructor: create canvas context failed, 'id' must be valuable");
        }, t.deviceRadio = e / 750;
    }, v.prototype.observer = function() {
        var t = this, e = [ "ready", "beforeImageLoad", "beforeDraw", "imageLoad" ];
        t.on = function(o, n) {
            var r;
            return e.indexOf(o) > -1 ? "function" == typeof n && ("ready" === o ? n(t) : t["on" + ((r = o).charAt(0).toUpperCase() + r.slice(1))] = n) : console.error("event: " + o + " is invalid"), 
            t;
        };
    }, v.prototype.methods = function() {
        var e = this, o = e.id, n = e.deviceRadio, r = e.width, a = e.height, i = e.cut, c = i.x;
        void 0 === c && (c = 0);
        var u = i.y;
        void 0 === u && (u = 0);
        var d = i.width;
        void 0 === d && (d = r);
        var s = i.height;
        void 0 === s && (s = a), e.updateCanvas = function() {
            return e.croperTarget && e.ctx.drawImage(e.croperTarget, e.imgLeft, e.imgTop, e.scaleWidth, e.scaleHeight), 
            t(e.onBeforeDraw) && e.onBeforeDraw(e.ctx, e), e.setBoundStyle(), e.ctx.draw(), 
            e;
        }, e.pushOrign = function(o) {
            return e.src = o, t(e.onBeforeImageLoad) && e.onBeforeImageLoad(e.ctx, e), wx.getImageInfo({
                src: o,
                success: function(o) {
                    var n = o.width / o.height;
                    e.croperTarget = o.path, n < d / s ? (e.rectX = c, e.baseWidth = d, e.baseHeight = d / n, 
                    e.rectY = u - Math.abs((s - e.baseHeight) / 2)) : (e.rectY = u, e.baseWidth = s * n, 
                    e.baseHeight = s, e.rectX = c - Math.abs((d - e.baseWidth) / 2)), e.imgLeft = e.rectX, 
                    e.imgTop = e.rectY, e.scaleWidth = e.baseWidth, e.scaleHeight = e.baseHeight, e.updateCanvas(), 
                    t(e.onImageLoad) && e.onImageLoad(e.ctx, e);
                }
            }), e.update(), e;
        }, e.getCropperBase64 = function(t) {
            void 0 === t && (t = function() {}), f.convertToBMP({
                canvasId: o,
                x: c,
                y: u,
                width: d,
                height: s
            }, t);
        }, e.getCropperImage = function() {
            for (var r = [], a = arguments.length; a--; ) r[a] = arguments[a];
            var i = toString.call(r[0]), h = r[r.length - 1];
            switch (i) {
              case "[object Object]":
                var f = r[0].quality;
                void 0 === f && (f = 10), "number" != typeof f ? console.error("quality：" + f + " is invalid") : (f < 0 || f > 10) && console.error("quality should be ranged in 0 ~ 10"), 
                wx.canvasToTempFilePath({
                    canvasId: o,
                    x: c,
                    y: u,
                    width: d,
                    height: s,
                    destWidth: d * f / (10 * n),
                    destHeight: s * f / (10 * n),
                    success: function(o) {
                        t(h) && h.call(e, o.tempFilePath);
                    },
                    fail: function(o) {
                        t(h) && h.call(e, null);
                    }
                });
                break;

              case "[object Function]":
                wx.canvasToTempFilePath({
                    canvasId: o,
                    x: c,
                    y: u,
                    width: d,
                    height: s,
                    destWidth: d / n,
                    destHeight: s / n,
                    success: function(o) {
                        t(h) && h.call(e, o.tempFilePath);
                    },
                    fail: function(o) {
                        t(h) && h.call(e, null);
                    }
                });
            }
            return e;
        };
    }, v.prototype.cutt = function() {
        var t = this, e = t.width, o = t.height, n = t.cut, r = n.x;
        void 0 === r && (r = 0);
        var a = n.y;
        void 0 === a && (a = 0);
        var i = n.width;
        void 0 === i && (i = e);
        var c = n.height;
        void 0 === c && (c = o), t.outsideBound = function(e, o) {
            t.imgLeft = e >= r ? r : t.scaleWidth + e - r <= i ? r + i - t.scaleWidth : e, t.imgTop = o >= a ? a : t.scaleHeight + o - a <= c ? a + c - t.scaleHeight : o;
        }, t.setBoundStyle = function(n) {
            void 0 === n && (n = {});
            var u = n.color;
            void 0 === u && (u = "#04b00f");
            var d = n.mask;
            void 0 === d && (d = "rgba(0, 0, 0, 0.3)");
            var s = n.lineWidth;
            void 0 === s && (s = 1);
            var h = [ {
                start: {
                    x: r - s,
                    y: a + 10 - s
                },
                step1: {
                    x: r - s,
                    y: a - s
                },
                step2: {
                    x: r + 10 - s,
                    y: a - s
                }
            }, {
                start: {
                    x: r - s,
                    y: a + c - 10 + s
                },
                step1: {
                    x: r - s,
                    y: a + c + s
                },
                step2: {
                    x: r + 10 - s,
                    y: a + c + s
                }
            }, {
                start: {
                    x: r + i - 10 + s,
                    y: a - s
                },
                step1: {
                    x: r + i + s,
                    y: a - s
                },
                step2: {
                    x: r + i + s,
                    y: a + 10 - s
                }
            }, {
                start: {
                    x: r + i + s,
                    y: a + c - 10 + s
                },
                step1: {
                    x: r + i + s,
                    y: a + c + s
                },
                step2: {
                    x: r + i - 10 + s,
                    y: a + c + s
                }
            } ];
            t.ctx.beginPath(), t.ctx.setFillStyle(d), t.ctx.fillRect(0, 0, r, o), t.ctx.fillRect(r, 0, i, a), 
            t.ctx.fillRect(r, a + c, i, o - a - c), t.ctx.fillRect(r + i, 0, e - r - i, o), 
            t.ctx.fill(), h.forEach(function(e) {
                t.ctx.beginPath(), t.ctx.setStrokeStyle(u), t.ctx.setLineWidth(s), t.ctx.moveTo(e.start.x, e.start.y), 
                t.ctx.lineTo(e.step1.x, e.step1.y), t.ctx.lineTo(e.step2.x, e.step2.y), t.ctx.stroke();
            });
        };
    }, v.prototype.update = function() {
        var t = this;
        t.src && (t.__oneTouchStart = function(e) {
            t.touchX0 = Math.round(e.x), t.touchY0 = Math.round(e.y);
        }, t.__oneTouchMove = function(e) {
            var o, n;
            if (t.touchended) return t.updateCanvas();
            o = Math.round(e.x - t.touchX0), n = Math.round(e.y - t.touchY0);
            var r = Math.round(t.rectX + o), a = Math.round(t.rectY + n);
            t.outsideBound(r, a), t.updateCanvas();
        }, t.__twoTouchStart = function(e, o) {
            var n, r, a;
            t.touchX1 = Math.round(t.rectX + t.scaleWidth / 2), t.touchY1 = Math.round(t.rectY + t.scaleHeight / 2), 
            n = Math.round(o.x - e.x), r = Math.round(o.y - e.y), a = Math.round(Math.sqrt(n * n + r * r)), 
            t.oldDistance = a;
        }, t.__twoTouchMove = function(e, o) {
            var n = t.oldScale, r = t.oldDistance, a = t.scale, i = t.zoom;
            t.newScale = l(n, r, i, e, o), t.newScale <= 1 && (t.newScale = 1), t.newScale >= a && (t.newScale = a), 
            t.scaleWidth = Math.round(t.newScale * t.baseWidth), t.scaleHeight = Math.round(t.newScale * t.baseHeight);
            var c = Math.round(t.touchX1 - t.scaleWidth / 2), u = Math.round(t.touchY1 - t.scaleHeight / 2);
            t.outsideBound(c, u), t.updateCanvas();
        }, t.__xtouchEnd = function() {
            t.oldScale = t.newScale, t.rectX = t.imgLeft, t.rectY = t.imgTop;
        });
    }, v;
});